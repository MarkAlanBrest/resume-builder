<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Certifications and Skills</title>
  <link rel="stylesheet" href="style.css">

  <style>
    .page-title {
      text-align: center;
      color: #0b3c6d;
      margin-bottom: 30px;
      font-size: 28px;
    }

    .system {
      color: #0b3c6d;
      font-weight: 600;
    }

    .program-box {
      background: #f1f6fb;
      border: 1px solid #c9d9ea;
      padding: 12px;
      margin-bottom: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="chat">

  <h1 class="page-title">NCST’s Resume Builder</h1>

  <div id="programDisplay" class="program-box"></div>

  <div class="system">
    The following certifications may be earned during your time at NCST.
  </div>

  <div id="programCerts"></div>

  <div class="system">Certifications earned outside of school (optional)</div>
  <textarea id="extraCerts"></textarea>

  <div class="system">Skills learned outside of school or work experience (optional)</div>
  <textarea id="extraSkills"></textarea>

  <br>

  <button onclick="goBack()">Back</button>
  <button onclick="goNext()">Next</button>

</div>

<script>
/* ===== PROGRAM CERT DATA ===== */
const PROGRAM_CERTS = {
  welding: {
    name: "Combination Welding",
    certifications: [
      "AWS D1.1 Structural Steel",
      "AWS D1.3 Sheet Metal",
      "FCAW Plate Certification",
      "OSHA 10",
      "Hot Work Safety"
    ]
  },
  electrical: {
    name: "Electrical Technology",
    certifications: [
      "OSHA 10",
      "NFPA 70E",
      "Electrical Safety Training"
    ]
  }
};

/* ===== STORAGE ===== */
function getData() {
  return JSON.parse(localStorage.getItem("resumeData")) || {};
}
function setData(data) {
  localStorage.setItem("resumeData", JSON.stringify(data));
}

/* ===== PROGRAM KEY FALLBACK ===== */
function resolveProgram(data) {
  // 1️⃣ Preferred: explicit key
  if (data.student?.programKey && PROGRAM_CERTS[data.student.programKey]) {
    return {
      key: data.student.programKey,
      name: data.student.programName
    };
  }

  // 2️⃣ Fallback: infer from programCampus text (safe, minimal)
  const text = (data.programCampus || "").toLowerCase();
  if (text.includes("welding")) {
    return { key: "welding", name: data.programCampus };
  }
  if (text.includes("electrical")) {
    return { key: "electrical", name: data.programCampus };
  }

  // 3️⃣ Final fallback
  return { key: "welding", name: "Combination Welding" };
}

/* ===== LOAD ===== */
window.onload = function () {
  const data = getData();

  data.certifications ||= {
    programCertsSelected: [],
    extraCerts: "",
    extraSkills: ""
  };

  const program = resolveProgram(data);

  document.getElementById("programDisplay").textContent =
    `Program Selected: ${program.name}`;

  document.getElementById("extraCerts").value =
    data.certifications.extraCerts || "";

  document.getElementById("extraSkills").value =
    data.certifications.extraSkills || "";

  const selected = data.certifications.programCertsSelected || [];
  const container = document.getElementById("programCerts");
  container.innerHTML = "";

  PROGRAM_CERTS[program.key].certifications.forEach((cert, i) => {
    const row = document.createElement("div");
    row.className = "check-row";

    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.id = "cert" + i;
    cb.value = cert;
    cb.checked = selected.includes(cert);

    const label = document.createElement("label");
    label.htmlFor = cb.id;
    label.textContent = cert;

    row.appendChild(cb);
    row.appendChild(label);
    container.appendChild(row);
  });
};

/* ===== NAV ===== */
function goBack() {
  window.location.href = "work.html";
}

function goNext() {
  const data = getData();

  data.certifications.programCertsSelected = Array.from(
    document.querySelectorAll("#programCerts input:checked")
  ).map(cb => cb.value);

  data.certifications.extraCerts =
    document.getElementById("extraCerts").value.trim();

  data.certifications.extraSkills =
    document.getElementById("extraSkills").value.trim();

  setData(data);
  window.location.href = "education-military-v2.html";
}
</script>

</body>
</html>