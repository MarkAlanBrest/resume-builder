<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Work Experience</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="chat">

  <div class="system">
    Have you worked before?
    <br><br>
    Add each job one at a time. When finished, click <strong>Next</strong> to continue.
  </div>

  <select id="worked">
    <option value="">-- Select --</option>
    <option value="yes">Yes</option>
    <option value="no">No</option>
  </select>

  <!-- JOB ENTRY -->
  <div id="jobEntry" style="display:none;">

    <div class="system">Employer name</div>
    <input id="employer">

    <div class="system">Job title</div>
    <input id="title">

    <div class="system">Start date (MM/YYYY)</div>
    <input id="startDate">

    <div class="system">End date (MM/YYYY or Present)</div>
    <input id="endDate">

    <div class="system">
      List tasks you performed
      <br><br>
      <strong>Important:</strong> Provide enough detail so this can be turned into
      <strong>multiple resume bullet points</strong>.
      <br>
      Describe:
      <ul>
        <li>What you did on a regular basis</li>
        <li>Tools, equipment, or systems you used</li>
        <li>Responsibilities you were trusted with</li>
        <li>Any accomplishments or improvements you contributed to</li>
      </ul>
      <strong>Example:</strong> Assisted with vehicle maintenance, used hand and power tools,
      followed safety procedures, and worked as part of a team to complete daily tasks.
    </div>

    <textarea id="tasks"></textarea>

    <button type="button" onclick="addJob()">Add Another Job / Employment</button>

  </div>

  <!-- JOB LIST -->
  <div id="jobList" style="display:none;">
    <div class="system">Jobs Entered</div>
    <ul id="jobs"></ul>
  </div>

  <!-- MILITARY SERVICE -->
  <div class="system">
    Have you served in the military? (optional)
  </div>

  <select id="military">
    <option value="">-- Select --</option>
    <option value="yes">Yes</option>
    <option value="no">No</option>
  </select>

  <div id="militarySection" style="display:none;">

    <div class="system">Branch and rank</div>
    <input id="militaryRank" placeholder="Example: U.S. Army – Specialist (E-4)">

    <div class="system">Duties performed</div>
    <textarea id="militaryDuties"></textarea>

    <div class="system">Achievements, awards, or promotions</div>
    <textarea id="militaryAchievements"></textarea>

    <div class="system">Additional military-related comments (optional)</div>
    <textarea id="militaryComments"></textarea>

  </div>

  <!-- OPTIONAL COMMENTS -->
  <div class="system">
    Additional comments or information (optional)
    <br>
    <strong>Examples:</strong> temporary work, internships, volunteer work,
    gaps in employment, or anything else you want an employer to know.
  </div>

  <textarea id="workComments"></textarea>

  <br>

  <button type="button" onclick="goBack()">Back</button>
  <button type="button" onclick="goNext()">Next</button>

</div>

<script>
/* ---------- STORAGE ---------- */
function getData() {
  return JSON.parse(localStorage.getItem("resumeData")) || {};
}
function setData(data) {
  localStorage.setItem("resumeData", JSON.stringify(data));
}

/* ---------- LOAD ---------- */
window.onload = function () {
  const data = getData();
  if (!Array.isArray(data.jobs)) data.jobs = [];

  document.getElementById("worked").value = data.worked || "";
  document.getElementById("workComments").value = data.workComments || "";

  document.getElementById("military").value = data.military || "";
  document.getElementById("militaryRank").value = data.militaryRank || "";
  document.getElementById("militaryDuties").value = data.militaryDuties || "";
  document.getElementById("militaryAchievements").value = data.militaryAchievements || "";
  document.getElementById("militaryComments").value = data.militaryComments || "";

  toggleWork();
  toggleMilitary();
  renderJobs();
};

document.getElementById("worked").addEventListener("change", toggleWork);
document.getElementById("military").addEventListener("change", toggleMilitary);

function toggleWork() {
  const worked = document.getElementById("worked").value;
  document.getElementById("jobEntry").style.display = worked === "yes" ? "block" : "none";
  document.getElementById("jobList").style.display = worked === "yes" ? "block" : "none";
}

function toggleMilitary() {
  const military = document.getElementById("military").value;
  document.getElementById("militarySection").style.display =
    military === "yes" ? "block" : "none";
}

/* ---------- JOB HANDLING ---------- */
function addJob() {
  const employer = employerVal();
  const title = titleVal();
  const start = startVal();
  const end = endVal();
  const tasks = tasksVal();

  if (!employer || !title || !start || !end || tasks.length < 10) {
    alert("Please complete all job fields with enough detail.");
    return;
  }

  const data = getData();
  if (!Array.isArray(data.jobs)) data.jobs = [];

  data.jobs.push({ employer, title, start, end, tasks });
  setData(data);

  clearInputs();
  renderJobs();
}

function renderJobs() {
  const data = getData();
  const list = document.getElementById("jobs");
  list.innerHTML = "";

  (data.jobs || []).forEach((job, index) => {
    const li = document.createElement("li");
    li.innerHTML = `
      <strong>${job.title}</strong> – ${job.employer}
      (${job.start} to ${job.end})
      <br>
      ${job.tasks}
      <br>
      <button type="button" onclick="deleteJob(${index})">Delete</button>
    `;
    list.appendChild(li);
  });
}

function deleteJob(index) {
  const data = getData();
  data.jobs.splice(index, 1);
  setData(data);
  renderJobs();
}

/* ---------- HELPERS ---------- */
function employerVal() { return document.getElementById("employer").value.trim(); }
function titleVal() { return document.getElementById("title").value.trim(); }
function startVal() { return document.getElementById("startDate").value.trim(); }
function endVal() { return document.getElementById("endDate").value.trim(); }
function tasksVal() { return document.getElementById("tasks").value.trim(); }

function clearInputs() {
  employer.value = "";
  title.value = "";
  startDate.value = "";
  endDate.value = "";
  tasks.value = "";
}

/* ---------- NAV ---------- */
function saveOnly() {
  const data = getData();
  data.worked = document.getElementById("worked").value;
  data.workComments = document.getElementById("workComments").value.trim();

  data.military = document.getElementById("military").value;
  data.militaryRank = document.getElementById("militaryRank").value.trim();
  data.militaryDuties = document.getElementById("militaryDuties").value.trim();
  data.militaryAchievements = document.getElementById("militaryAchievements").value.trim();
  data.militaryComments = document.getElementById("militaryComments").value.trim();

  setData(data);
}

function goBack() {
  window.location.href = "objective.html";
}

function goNext() {
  const worked = document.getElementById("worked").value;
  const data = getData();

  if (!worked) {
    alert("Please indicate whether you have worked before.");
    return;
  }

  if (worked === "yes" && (!data.jobs || data.jobs.length === 0)) {
    alert("Please add at least one job or change your selection to No.");
    return;
  }

  saveOnly();
  window.location.href = "certifications.html";
}
</script>

</body>
</html>
